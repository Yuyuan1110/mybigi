---
tags: 
  - programming
  - C
  - inline 
alias: []
created: 2025-07-04
updated:
source:
---
# `inline` 關鍵字

`inline` 關鍵字是 C99 標準引入的（在 C++ 中也存在），它是一個**提示**，告訴編譯器希望將一個函數的程式碼**直接嵌入**到呼叫它的地方，而不是生成單獨的函數呼叫。這種行為稱為**函數內聯 (Function Inlining)**。

`inline` 的目的是**減少函數呼叫的開銷**，從而提高程式效能，尤其適用於那些程式碼量很小但被頻繁呼叫的函數。

```clike
#include <stdio.h>

// inline 函數的定義通常放在標頭檔中，或在使用前定義
// 通常需要搭配 static 或 extern
static inline int add(int a, int b) {
    return a + b;
}

int main() {
    int x = 10, y = 20;
    int sum = add(x, y); // 編譯器可能會將這裡的呼叫替換為 (x + y)

    printf("Sum: %d\n", sum); // 輸出 30

    // inline 函數的參數是嚴格型別檢查的
    // float res = add(10.5f, 20.3f); // 這會產生警告或錯誤，因為參數是 float 而不是 int
    return 0;
}
```

**`inline` 的優點：**

- **減少函數呼叫開銷**：這是其主要目的，可以帶來效能提升。
    
- **型別安全**：與普通函數一樣，`inline` 函數會進行嚴格的型別檢查。
    
- **避免副作用**：參數只會被求值一次，不會有宏的副作用問題。
    
- **可調試性**：調試器通常可以像處理普通函數一樣處理 `inline` 函數。
    

**`inline` 的缺點/注意事項：**

- **只是編譯器的建議**：編譯器有權忽略 `inline` 關鍵字。它可能出於各種原因（例如函數體過大、遞歸呼叫等）而選擇不內聯函數。
    
- **程式碼膨脹 (Code Bloat)**：如果一個 `inline` 函數被內聯到很多地方，它的程式碼會被複製多份，可能導致最終可執行檔的大小增加。
    
- **可能導致快取效率降低**：程式碼膨脹可能會導致指令快取命中率降低。
    
- **複雜的語義**：在 C 語言中，`inline` 的使用規則比 C++ 更為複雜，特別是涉及多個原始檔和連結器時。通常需要與 `static` 或 `extern` 關鍵字結合使用。
